//%attributes = {"lang":"en"} comment added and reserved by 4D.
QUERY([Trxs];[Trxs]Charge=True;*)
If (bLast=1)
QUERY([Trxs]; & ;[Trxs]TrxDate>Current date-31;*)
End if 
QUERY([Trxs]; & ;[Trxs]Match=-999;*)
Case of 
: (asStockDisplay=2)
QUERY([Trxs]; & ;[Trxs]OriginalReceipt="PURCHASE";*)
OBJECT SET ENABLED(bAdd;True)
OBJECT SET ENABLED(bAdjustment;False)
OBJECT SET ENABLED(bTransfer;False)
OBJECT SET ENABLED(bReceive;False)
: (asStockDisplay=3)
QUERY([Trxs]; & ;[Trxs]OriginalReceipt="ADJUSTMENT";*)
OBJECT SET ENABLED(bAdd;False)
OBJECT SET ENABLED(bAdjustment;True)
OBJECT SET ENABLED(bTransfer;False)
OBJECT SET ENABLED(bReceive;False)
: (asStockDisplay=4)
QUERY([Trxs]; & ;[Trxs]OriginalReceipt="TRANSFER";*)
OBJECT SET ENABLED(bAdd;False)
OBJECT SET ENABLED(bAdjustment;False)
OBJECT SET ENABLED(bTransfer;True)
OBJECT SET ENABLED(bReceive;True)
Else 
OBJECT SET ENABLED(bAdd;True)
OBJECT SET ENABLED(bAdjustment;True)
OBJECT SET ENABLED(bTransfer;True)
OBJECT SET ENABLED(bReceive;True)
End case 
QUERY([Trxs]; & ;[Trxs]AgreeNo=<>sFacility)
ORDER BY([Trxs]TrxDate;<;[Trxs]Charge;>;[Trxs]TotAmt;>)