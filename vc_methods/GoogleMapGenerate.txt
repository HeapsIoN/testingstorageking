//%attributes = {"lang":"en"} comment added and reserved by 4D.
C_TEXT($1;$googleFile)

$doc:=Create document(<>sResourcesPath+"map.htm")

$googleFile:="<!DOCTYPE html\"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n"
$googleFile:=$googleFile+"<html xmlns=\"http://www.w3.org/1999/xhtml\">\n"
$googleFile:=$googleFile+"<head>\n"
$googleFile:=$googleFile+"<meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"/>\n"
$googleFile:=$googleFile+"<title>Storman Google Maps Interface</title>\n"
$googleFile:=$googleFile+"<script src=\"http://maps.google.com/maps?file=api&amp;v=2.x&amp;key="+$1+"&sensor=false\"Type=\"text/javascript\"></script>\n"
$googleFile:=$googleFile+"<script type=\"text/javascript\">\n"
$googleFile:=$googleFile+"var map = null;\n"
$googleFile:=$googleFile+"var geocoder = null;\n"
$googleFile:=$googleFile+"var alerted = \"\";\n"
$googleFile:=$googleFile+"var directions;\n"
$googleFile:=$googleFile+"var visDirections;\n"
$googleFile:=$googleFile+"var dist;\n"
$googleFile:=$googleFile+"var loaded = 0;\n"
$googleFile:=$googleFile+"function initialize(){\n"
$googleFile:=$googleFile+"if (GBrowserIsCompatible()){\n"
$googleFile:=$googleFile+"map = new GMap2(document.getElementById(\"map_canvas\"));\n"
$googleFile:=$googleFile+"map.setCenter(new GLatLng(-33.86596896, 151.089894), 13);\n"
$googleFile:=$googleFile+"map.setUIToDefault();\n"
$googleFile:=$googleFile+"geocoder = new GClientGeocoder();\n"
$googleFile:=$googleFile+"directions = new GDirections();\n"
$googleFile:=$googleFile+"visDirections = new GDirections(map);\n"
$googleFile:=$googleFile+"GEvent.addListener(directions,\"load\", function(){loaded = 1;});\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"function confirmAlert(){\n"
$googleFile:=$googleFile+"var toReturn = alerted;\n"
$googleFile:=$googleFile+"alerted = \"0\";\n"
$googleFile:=$googleFile+"return toReturn;\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"function loadFacility(facilityCoords, facilityName){\n"
$googleFile:=$googleFile+"var fLat = facilityCoords.substring(0, facilityCoords.indexOf(\",\"));\n"
$googleFile:=$googleFile+"var fLng = facilityCoords.substring(facilityCoords.indexOf(\",\")+1);\n"
$googleFile:=$googleFile+"map.addOverlay(new GMarker(new GLatLng(fLat, fLng),{title:facilityName}));\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"function showAddress(address, physAddress){\n"
$googleFile:=$googleFile+"if (geocoder){\n"
$googleFile:=$googleFile+"geocoder.getLatLng(\n"
$googleFile:=$googleFile+"address,\n"
$googleFile:=$googleFile+"function(point){\n"
$googleFile:=$googleFile+"if (!point){\n"
$googleFile:=$googleFile+"alerted = \"1\";\n"
$googleFile:=$googleFile+"}else {\n"
$googleFile:=$googleFile+"map.setCenter(point, 13);\n"
$googleFile:=$googleFile+"map.panTo(point, 13);\n"
$googleFile:=$googleFile+"var marker = new GMarker(point);\n"
$googleFile:=$googleFile+"map.addOverlay(marker);\n"
$googleFile:=$googleFile+"marker.openInfoWindowHtml(physAddress);\n"
$googleFile:=$googleFile+"alerted = point;\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+");\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"function calcDistance(address, facility){\n"
$googleFile:=$googleFile+"directions.load(\"from: \"+address+\" to: \"+facility);\n"
$googleFile:=$googleFile+"loaded = 0;\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"function getDistance(){\n"
$googleFile:=$googleFile+"if (loaded == 1){\n"
$googleFile:=$googleFile+"dist = directions.getDistance().meters;\n"
$googleFile:=$googleFile+"return dist;\n"
$googleFile:=$googleFile+"}else {\n"
$googleFile:=$googleFile+"return loaded;\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"function showRoute(address, facility){\n"
$googleFile:=$googleFile+"visDirections.load(\"from: \"+address+\" to: \"+facility);\n"
$googleFile:=$googleFile+"}\n"
$googleFile:=$googleFile+"</script>\n"
$googleFile:=$googleFile+"</head>\n"
$googleFile:=$googleFile+"<body style=\"margin-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px\" onload=\"initialize()\" onunload=\"GUnload()\">\n"
$googleFile:=$googleFile+"<div id=\"map_canvas\" style=\"width: 274px; height: 295px; border: 1px solid rgb(0,0,0)\"></div>\n"
$googleFile:=$googleFile+"</body>\n"
$googleFile:=$googleFile+"</html>\n"

SEND PACKET($doc;$googleFile)
CLOSE DOCUMENT($doc)
