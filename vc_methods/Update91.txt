//%attributes = {"lang":"en"} comment added and reserved by 4D.

READ WRITE([Agreement])
READ WRITE([Authenticate])
READ WRITE([Letters])
READ WRITE([OtherChgs])
READ WRITE([PromotionHistory])
READ WRITE([Reservation])
READ WRITE([Trxs])
READ WRITE([Unit])
READ WRITE([UnitHistory])
READ WRITE([Facility])
QUERY([Facility];[Facility]NonSyncingSiteMV=True;*)
QUERY([Facility]; | ;[Facility]FacilityCode=<>sFacility)
For ($k;1;Records in selection([Facility]))
[Facility]GraphiconInv:=False
[Facility]CustomInvFooter:=False
[Facility]UseCustomReceipt:=False

QUERY([Agreement];[Agreement]RAgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Agreement]; & ;[Agreement]RAgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Agreement]; & ;[Agreement]RAgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Agreement]; & ;[Agreement]RAgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Agreement];Length([Agreement]AgreeNo)=5)
APPLY TO SELECTION([Agreement];[Agreement]AgreeNo:="0000"+[Agreement]AgreeNo)
APPLY TO SELECTION([Agreement];[Agreement]RAgreeNo:=[Facility]FacilityCode+"0000"+Substring([Agreement]RAgreeNo;6))

QUERY([Agreement];[Agreement]RAgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Agreement]; & ;[Agreement]RAgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Agreement]; & ;[Agreement]RAgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Agreement]; & ;[Agreement]RAgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Agreement];Length([Agreement]AgreeNo)=5)
APPLY TO SELECTION([Agreement];[Agreement]AgreeNo:="#0000"+Substring([Agreement]AgreeNo;2))
APPLY TO SELECTION([Agreement];[Agreement]RAgreeNo:=[Facility]FacilityCode+"#0000"+Substring([Agreement]RAgreeNo;7))

QUERY([Authenticate];[Authenticate]RAgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Authenticate]; & ;[Authenticate]RAgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Authenticate]; & ;[Authenticate]RAgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Authenticate]; & ;[Authenticate]RAgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Authenticate];Length([Authenticate]RAgreeNo)=10)
APPLY TO SELECTION([Authenticate];[Authenticate]RAgreeNo:=[Facility]FacilityCode+"0000"+Substring([Authenticate]RAgreeNo;6))

QUERY([Authenticate];[Authenticate]RAgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Authenticate]; & ;[Authenticate]RAgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Authenticate]; & ;[Authenticate]RAgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Authenticate]; & ;[Authenticate]RAgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Authenticate];Length([Authenticate]RAgreeNo)=10)
APPLY TO SELECTION([Authenticate];[Authenticate]RAgreeNo:=[Facility]FacilityCode+"#0000"+Substring([Authenticate]RAgreeNo;7))

QUERY([Letters];[Letters]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Letters]; & ;[Letters]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Letters]; & ;[Letters]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Letters]; & ;[Letters]AgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Letters];Length([Letters]AgreeNo)=10)
APPLY TO SELECTION([Letters];[Letters]AgreeNo:=[Facility]FacilityCode+"0000"+Substring([Letters]AgreeNo;6))

QUERY([Letters];[Letters]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Letters]; & ;[Letters]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Letters]; & ;[Letters]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Letters]; & ;[Letters]AgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Letters];Length([Letters]AgreeNo)=10)
APPLY TO SELECTION([Letters];[Letters]AgreeNo:=[Facility]FacilityCode+"#0000"+Substring([Letters]AgreeNo;7))

QUERY([OtherChgs];[OtherChgs]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([OtherChgs]; & ;[OtherChgs]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([OtherChgs]; & ;[OtherChgs]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([OtherChgs]; & ;[OtherChgs]AgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([OtherChgs];Length([OtherChgs]AgreeNo)=10)
APPLY TO SELECTION([OtherChgs];[OtherChgs]AgreeNo:=[Facility]FacilityCode+"0000"+Substring([OtherChgs]AgreeNo;6))

QUERY([OtherChgs];[OtherChgs]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([OtherChgs]; & ;[OtherChgs]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([OtherChgs]; & ;[OtherChgs]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([OtherChgs]; & ;[OtherChgs]AgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([OtherChgs];Length([OtherChgs]AgreeNo)=10)
APPLY TO SELECTION([OtherChgs];[OtherChgs]AgreeNo:=[Facility]FacilityCode+"#0000"+Substring([OtherChgs]AgreeNo;7))

QUERY([PromotionHistory];[PromotionHistory]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]AgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([PromotionHistory];Length([PromotionHistory]AgreeNo)=10)
APPLY TO SELECTION([PromotionHistory];[PromotionHistory]AgreeNo:=[Facility]FacilityCode+"0000"+Substring([PromotionHistory]AgreeNo;6))

QUERY([PromotionHistory];[PromotionHistory]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]AgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([PromotionHistory];Length([PromotionHistory]AgreeNo)=10)
APPLY TO SELECTION([PromotionHistory];[PromotionHistory]AgreeNo:=[Facility]FacilityCode+"#0000"+Substring([PromotionHistory]AgreeNo;7))

QUERY([PromotionHistory];[PromotionHistory]RefAgreeNo=[Facility]FacilityCode+"@";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]RefAgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]RefAgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]RefAgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([PromotionHistory];Length([PromotionHistory]RefAgreeNo)=10)
APPLY TO SELECTION([PromotionHistory];[PromotionHistory]RefAgreeNo:=[Facility]FacilityCode+"0000"+Substring([PromotionHistory]RefAgreeNo;6))

QUERY([PromotionHistory];[PromotionHistory]RefAgreeNo=[Facility]FacilityCode+"@";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]RefAgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]RefAgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([PromotionHistory]; & ;[PromotionHistory]RefAgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([PromotionHistory];Length([PromotionHistory]RefAgreeNo)=10)
APPLY TO SELECTION([PromotionHistory];[PromotionHistory]RefAgreeNo:=[Facility]FacilityCode+"#0000"+Substring([PromotionHistory]RefAgreeNo;7))

QUERY([Reservation];[Reservation]RReserveNo=[Facility]FacilityCode+"@")
QUERY SELECTION BY FORMULA([Reservation];Length([Reservation]ReserveNo)=4)
APPLY TO SELECTION([Reservation];[Reservation]ReserveNo:="0000"+[Reservation]ReserveNo)
APPLY TO SELECTION([Reservation];[Reservation]RReserveNo:=[Facility]FacilityCode+"0000"+Substring([Reservation]RReserveNo;6))

QUERY([Trxs];[Trxs]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode;*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Trxs];Length([Trxs]AgreeNo)=10)
APPLY TO SELECTION([Trxs];[Trxs]AgreeNo:=[Facility]FacilityCode+"0000"+Substring([Trxs]AgreeNo;6))

QUERY([Trxs];[Trxs]AgreeNo=[Facility]FacilityCode+"@";*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode+"MISCL";*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode+"PETTY";*)
QUERY([Trxs]; & ;[Trxs]AgreeNo#[Facility]FacilityCode;*)
QUERY([Trxs]; & ;[Trxs]AgreeNo=[Facility]FacilityCode+"#@")
QUERY SELECTION BY FORMULA([Trxs];Length([Trxs]AgreeNo)=10)
APPLY TO SELECTION([Trxs];[Trxs]AgreeNo:=[Facility]FacilityCode+"#0000"+Substring([Trxs]AgreeNo;7))

QUERY([Unit];[Unit]AgreeNo=[Facility]FacilityCode+"@")
QUERY SELECTION BY FORMULA([Unit];Length([Unit]AgreeNo)=10)
APPLY TO SELECTION([Unit];[Unit]AgreeNo:=[Facility]FacilityCode+"0000"+Substring([Unit]AgreeNo;6))

QUERY([Unit];[Unit]ReservedTo=[Facility]FacilityCode+"@")
QUERY SELECTION BY FORMULA([Unit];Length([Unit]ReservedTo)=9)
APPLY TO SELECTION([Unit];[Unit]ReservedTo:=[Facility]FacilityCode+"0000"+Substring([Unit]ReservedTo;6))

QUERY([UnitHistory];[UnitHistory]AgreeNo=[Facility]FacilityCode+"@")
QUERY SELECTION BY FORMULA([UnitHistory];Length([UnitHistory]AgreeNo)=10)
APPLY TO SELECTION([UnitHistory];[UnitHistory]AgreeNo:=[Facility]FacilityCode+"0000"+Substring([UnitHistory]AgreeNo;6))


SAVE RECORD([Facility])
NEXT RECORD([Facility])
End for 
READ ONLY([Agreement])
READ ONLY([Authenticate])
READ ONLY([Letters])
READ ONLY([OtherChgs])
READ ONLY([PromotionHistory])
READ ONLY([Reservation])
READ ONLY([Trxs])
READ ONLY([Unit])
READ ONLY([UnitHistory])
READ ONLY([Facility])
CalcBalance (True;False;False;True;True)
SetFacility 