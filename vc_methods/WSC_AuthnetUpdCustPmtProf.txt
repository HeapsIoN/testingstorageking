//%attributes = {"lang":"en"} comment added and reserved by 4D.
// 
// WSC_AuthnetUpdCustPmtProf
// https://api.authorize.net/soap/v1/Service.asmx?WSDL
// 
// Method source code automatically generated by the 4D SOAP wizard.
// ----------------------------------------------------------------

C_TEXT($1)
C_TEXT($2)
C_TEXT($3)
C_TEXT($4)
C_TEXT($5)
C_TEXT($6)
C_TEXT($7)
C_TEXT($8)
C_TEXT($9)
C_TEXT($10)
C_TEXT($11)
C_TEXT($12)
C_TEXT($13)
C_TEXT($14)
C_TEXT($15)
C_TEXT($16)
C_TEXT($17)
C_TEXT(AuthnetUCPResultCode)
C_TEXT(AuthnetUCPCode)
C_TEXT(AuthnetUCPText)
C_TEXT(AuthnetUCPDirectResponse)
C_LONGINT($WSCResult)

$oldErrMethod:=Method called on error

ON ERR CALL("ErrorNone")

C_TEXT($root)
C_TEXT($subelem)
C_TEXT($namespace)
$namespace:="https://api.authorize.net/soap/v1/"
$root:=DOM Create XML Ref("UpdateCustomerPaymentProfile";$namespace)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/merchantAuthentication/name")//[Facility]MerchantDetails
DOM SET XML ELEMENT VALUE($subelem;$1)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/merchantAuthentication/transactionKey")//[Facility]MerchantDetails
DOM SET XML ELEMENT VALUE($subelem;$2)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/customerProfileId")//[Customer]customerProfileID
DOM SET XML ELEMENT VALUE($subelem;$3)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/customerType")//[Customer]Organization
DOM SET XML ELEMENT VALUE($subelem;$4)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/firstName")//[Customer]FirstName
DOM SET XML ELEMENT VALUE($subelem;$5)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/lastName")//[Customer]CustomerName
DOM SET XML ELEMENT VALUE($subelem;$6)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/company")//[Customer]CustomerName
DOM SET XML ELEMENT VALUE($subelem;$7)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/address")//[Customer]MailAddress
DOM SET XML ELEMENT VALUE($subelem;$8)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/city")//[Customer]MailCity
DOM SET XML ELEMENT VALUE($subelem;$9)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/state")//[Customer]MailState
DOM SET XML ELEMENT VALUE($subelem;$10)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/zip")//[Customer]MailPostZIPCode
DOM SET XML ELEMENT VALUE($subelem;$11)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/billTo/country")//[Customer]MailCountry
DOM SET XML ELEMENT VALUE($subelem;$12)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/payment/creditCard/cardNumber")//[Customer]CCNo
DOM SET XML ELEMENT VALUE($subelem;$13)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/payment/creditCard/expirationDate")//[Customer]CCExpiry
DOM SET XML ELEMENT VALUE($subelem;$14)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/payment/bankAccount/")//[Customer]BankAcct
DOM SET XML ELEMENT VALUE($subelem;$15)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/paymentProfile/customerPaymentProfileId")//[Customer]custPaymentProfID
DOM SET XML ELEMENT VALUE($subelem;$16)

$subelem:=DOM Create XML element($root;"/UpdateCustomerPaymentProfile/validationMode")
DOM SET XML ELEMENT VALUE($subelem;$17)


WEB SERVICE SET PARAMETER("XMLIn";$root)

If ($1="5n4C7ChL6fd")
WEB SERVICE CALL("https://apitest.authorize.net/soap/v1/Service.asmx";"https://api.authorize.net/soap/v1/UpdateCustomerPaymentProfile";"UpdateCustomerPaymentProfile";"https://api.authorize.net/soap/v1/";Web Service manual)
Else 
WEB SERVICE CALL("https://api.authorize.net/soap/v1/Service.asmx";"https://api.authorize.net/soap/v1/UpdateCustomerPaymentProfile";"UpdateCustomerPaymentProfile";"https://api.authorize.net/soap/v1/";Web Service manual)
End if 
$WSCResult:=Num(WEB SERVICE Get info(0))

If ($WSCResult=0)
C_BLOB($blob)
C_TEXT($resroot)
C_TEXT($ressubelem)
WEB SERVICE GET RESULT($blob;"XMLOut";*)
$resroot:=DOM Parse XML variable($blob)

$ressubelem:=DOM Find XML element($resroot;"/UpdateCustomerPaymentProfileResponse/UpdateCustomerPaymentProfileResult/resultCode")
DOM GET XML ELEMENT VALUE($ressubelem;AuthnetUCPResultCode)

$ressubelem:=DOM Find XML element($resroot;"/UpdateCustomerPaymentProfileResponse/UpdateCustomerPaymentProfileResult/messages/MessagesTypeMessage/code")
DOM GET XML ELEMENT VALUE($ressubelem;AuthnetUCPCode)

$ressubelem:=DOM Find XML element($resroot;"/UpdateCustomerPaymentProfileResponse/UpdateCustomerPaymentProfileResult/messages/MessagesTypeMessage/text")
DOM GET XML ELEMENT VALUE($ressubelem;AuthnetUCPText)

DOM CLOSE XML($resroot)

If (AuthnetUCPResultCode="Error")
AlertMessage (AuthnetUCPCode+" - "+AuthnetUCPText)
SyncRecordLog ("Error# "+AuthnetUCPCode+"-"+AuthnetUCPText)
Else 
AlertMessage (Get localized string("Profile updated"))
End if 

Else 
If (Not(IsAWebProcess ))
AlertMessage (Get localized string("There was an error contacting the AuthorizeNet CIM servers, try again later."))
SyncRecordLog (WEB SERVICE Get info(0)+" "+WEB SERVICE Get info(Web Service detailed message))
End if 
$0:="ERR4IC"
End if 

DOM CLOSE XML($root)


ON ERR CALL($oldErrMethod)

