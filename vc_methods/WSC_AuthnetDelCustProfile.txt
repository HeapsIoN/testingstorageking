//%attributes = {"lang":"en"} comment added and reserved by 4D.
// 
// WSC_AuthnetDelCustProfile
// https://api.authorize.net/soap/v1/Service.asmx?WSDL
// 
// Method source code automatically generated by the 4D SOAP wizard.
// ----------------------------------------------------------------

C_TEXT($1)
C_TEXT($2)
C_TEXT($3)
C_TEXT(AuthnetDCPCode)
C_TEXT(AuthnetDCPCode)
C_TEXT(AuthnetDCPText)
C_LONGINT($WSCResult)

$oldErrMethod:=Method called on error

ON ERR CALL("ErrorNone")

C_TEXT($root)
C_TEXT($subelem)
C_TEXT($namespace)
$namespace:="https://api.authorize.net/soap/v1/"
$root:=DOM Create XML Ref("DeleteCustomerProfile";$namespace)

$subelem:=DOM Create XML element($root;"/DeleteCustomerProfile/merchantAuthentication/name")//[Facility]MerchantDetails
DOM SET XML ELEMENT VALUE($subelem;$1)

$subelem:=DOM Create XML element($root;"/DeleteCustomerProfile/merchantAuthentication/transactionKey")//[Facility]MerchantDetails
DOM SET XML ELEMENT VALUE($subelem;$2)

$subelem:=DOM Create XML element($root;"/DeleteCustomerProfile/customerProfileId")//[customer]customerprofileID
DOM SET XML ELEMENT VALUE($subelem;$3)

WEB SERVICE SET PARAMETER("XMLIn";$root)

If ($1="5n4C7ChL6fd")
WEB SERVICE CALL("https://apitest.authorize.net/soap/v1/Service.asmx";"https://api.authorize.net/soap/v1/DeleteCustomerProfile";"DeleteCustomerProfile";"https://api.authorize.net/soap/v1/";Web Service manual)
Else 
WEB SERVICE CALL("https://api.authorize.net/soap/v1/Service.asmx";"https://api.authorize.net/soap/v1/DeleteCustomerProfile";"DeleteCustomerProfile";"https://api.authorize.net/soap/v1/";Web Service manual)
End if 
$WSCResult:=Num(WEB SERVICE Get info(0))

If ($WSCResult=0)
C_BLOB($blob)
C_TEXT($resroot)
C_TEXT($ressubelem)
WEB SERVICE GET RESULT($blob;"XMLOut";*)
$resroot:=DOM Parse XML variable($blob)

$ressubelem:=DOM Find XML element($resroot;"/DeleteCustomerProfileResponse/DeleteCustomerProfileResult/resultCode")
DOM GET XML ELEMENT VALUE($ressubelem;AuthnetDCPCode)

$ressubelem:=DOM Find XML element($resroot;"/DeleteCustomerProfileResponse/DeleteCustomerProfileResult/messages/MessagesTypeMessage/code")
DOM GET XML ELEMENT VALUE($ressubelem;AuthnetDCPCode)

$ressubelem:=DOM Find XML element($resroot;"/DeleteCustomerProfileResponse/DeleteCustomerProfileResult/messages/MessagesTypeMessage/text")
DOM GET XML ELEMENT VALUE($ressubelem;AuthnetDCPText)

DOM CLOSE XML($resroot)

If (AuthnetDCPCode="Error")
AlertMessage (AuthnetDCPCode+" - "+AuthnetDCPText)
SyncRecordLog ("Error# "+AuthnetDCPCode+"-"+AuthnetDCPText)
Else 
AlertMessage (Get localized string("Profile deleted"))
End if 

Else 
If (Not(IsAWebProcess ))
AlertMessage (Get localized string("There was an error contacting the AuthorizeNet CIM servers, try again later."))
SyncRecordLog (WEB SERVICE Get info(0)+" "+WEB SERVICE Get info(Web Service detailed message))
End if 
$0:="ERR4IC"
AuthnetDCPCode:="Error"
End if 

DOM CLOSE XML($root)
ON ERR CALL($oldErrMethod)
